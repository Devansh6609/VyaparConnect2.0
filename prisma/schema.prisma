// schema.prisma

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                 String    @id @default(cuid())
  name               String
  email              String    @unique
  phone              String?   @unique
  password           String
  whatsappBusinessId String?   @unique // âœ… ADDED: To link user to a WhatsApp Business Phone ID
  createdAt          DateTime  @default(now())
  updatedAt          DateTime  @updatedAt
  contacts           Contact[]
  products           Product[]
  quotations         Quotation[] @relation("UserQuotations")
}

model Contact {
  id          String    @id @default(cuid())
  name        String
  phone       String    @unique
  lastAddress String?
  avatarUrl   String?
  createdAt   DateTime  @default(now())
  updatedAt   DateTime  @updatedAt
  user        User      @relation(fields: [userId], references: [id])
  userId      String
  messages    Message[]
  quotations  Quotation[] @relation("ContactQuotations")
  unreadCount  Int       @default(0)
}

model Message {
  id        String   @id @default(cuid())
  from      String   // "business" or "customer"
  to        String
  text      String?
  mediaUrl  String?
  type      String   // text, image, document
  createdAt DateTime @default(now())
  contact   Contact  @relation(fields: [contactId], references: [id])
  contactId String
}

model Product {
  id          String          @id @default(cuid())
  name        String
  description String?
  price       Float
  imageUrl    String?
  category    String?
  inStock     Boolean         @default(true)
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  user        User            @relation(fields: [userId], references: [id])
  userId      String
  quotations  QuotationItem[]
  Quotation   Quotation[]
}

model Quotation {
  id            String          @id @default(cuid())
  customerName  String
  contactNumber String
  address       String
  productId     String
  product       Product         @relation(fields: [productId], references: [id])
  quantity      Int
  price         Int
  total         Int
  createdAt     DateTime        @default(now())
  user          User?           @relation("UserQuotations", fields: [userId], references: [id])
  userId        String?
  contact       Contact?        @relation("ContactQuotations", fields: [contactId], references: [id])
  contactId     String?
  items         QuotationItem[]
  payment       Payment?
}

model QuotationItem {
  id          String    @id @default(cuid())
  product     Product   @relation(fields: [productId], references: [id])
  productId   String
  quotation   Quotation @relation(fields: [quotationId], references: [id])
  quotationId String
  quantity    Int       @default(1)
  price       Float
}

model Payment {
  id                String    @id @default(cuid())
  razorpayOrderId   String    @unique
  razorpayPaymentId String?
  amount            Float
  status            String    @default("CREATED") // CREATED, PAID, FAILED
  createdAt         DateTime  @default(now())
  quotation         Quotation @relation(fields: [quotationId], references: [id])
  quotationId       String    @unique
}